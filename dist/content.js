!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["api-to-interface"]=t()}(this,function(){function s(e,o,i,c){return new(i=i||Promise)(function(n,t){function r(e){try{a(c.next(e))}catch(e){t(e)}}function s(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(r,s)}a((c=c.apply(e,o||[])).next())})}const h=e=>e.substr(0,1).toUpperCase()+e.slice(1),y=e=>{var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)},f=e=>{var t=document.createElement("div"),n=(t.classList="to-ts-msg",document.createElement("div"));n.innerText=e.text||"success~",t.appendChild(n),document.body.appendChild(t),setTimeout(function(){t.classList="to-ts-msg is-leaving",t.addEventListener("transitionend",function(){document.body.contains(t)&&document.body.removeChild(t)})},2e3)},p=(n,e=" | ")=>((n=n instanceof Array?n:n.split(",")).forEach((e,t)=>{"integer"===e&&(n[t]="number")}),n.join(e)),n=new XMLHttpRequest,a=()=>{var e=window.location.pathname.replace(/\/project\/\d+\/interface\/api\//,"");const t=window.location.protocol+"//"+window.location.host+"/api/interface/get?id="+e;return new Promise(e=>{n.open("GET",t,!0),n.send(),n.onreadystatechange=()=>{4==n.readyState&&200==n.status&&e(n.responseText)}})},m={resBtn:{field:"res_body",innerText:"返回值转换"},bodyBtn:{field:"req_body_other",innerText:"Body参数转换"},queryBtn:{field:"req_query",innerText:"Query参数转换"},bodyAndResBtn:{field:"res_body",innerText:"Body和返回值转换"}};class e{constructor(e){this.exportStr="",this.apiUrl=e,this.separator=";"}deepClone(e){var t,n=e instanceof Array?[]:{};for(t in e)e[t]&&"object"==typeof e[t]?n[t]=this.deepClone(e[t]):n[t]=e[t];return n}deepCloneToType(e){var t,n,r=e instanceof Array?[]:{};for(t in e)e[t]&&"object"==typeof e[t]?r[t]=this.deepCloneToType(e[t]):(n=typeof e[t],r[t]=this.judgeValueType(n));return r}judgeValueType(e){let t=e;switch(e){case"number":t="number";break;case"string":t="string";break;case"boolean":t="boolean";break;default:t="any"}return t}formatToTsInterface(r,s){let a=this.deepClone(r),t=(s=h(s),Object.keys(r).forEach(e=>{var t,n=""+s+h(e);"object"==typeof r[e]&&(r[e]instanceof Array?0===r[e].length?a[e]="any[]":"object"==typeof r[e][0]?(a[e]=n+"[]",this.formatToTsInterface(r[e][0],n)):(t=typeof r[e][0],a[e]=t+"[]"):(a[e]=n,this.formatToTsInterface(r[e],n)))}),"");Object.keys(a).forEach(e=>{t+=`
  ${e}: `+a[e]+this.separator}),this.generateExportStr(s,t)}jsonSchemaToTsInterface(e,t){let n=this.deepClone(e);for(var r in t=h(t),e){var s=""+t+h(r),{type:a,description:o,properties:i,items:c}=e[r];if("required"!==r&&(n[r]={type:p(a),description:o},n.required)&&n.required.includes(r)&&(n[r].required=!0),"object"===a&&(n[r].type=s),"array"===a){var l=c&&c.type?c.type:"any";switch(l){case"object":case"array":n[r].type=s+"[]",this.jsonSchemaToTsInterface(c.properties,s);break;default:n[r].type=l+"[]"}}i&&(this.jsonSchemaToTsInterface(i,s),delete n[r].properties)}let d="";Object.keys(n).forEach(e=>{n[e].description&&(d+=`
  /** ${n[e].description} */`),n[e].type&&(d+=`
  ${e}${n[e].required?"":"?"}: `+n[e].type+this.separator)}),this.generateExportStr(t,d)}queryToTsInterface(e,t){let r="";t=h(t),e.forEach(e=>{var{desc:e,name:t,required:n}=e;e&&(r+=`
 /** ${e} */`),r+=`
 ${t}${"1"===n?"":"?"}: string`+this.separator}),this.generateExportStr(t,r)}generateExportStr(e,t){this.exportStr="export interface "+e+" {"+t+"\n}\n\n"+this.exportStr}compile(e,t,n,r){switch(this.exportStr="",n){case"json_schema":this.jsonSchemaToTsInterface(e,t);break;case"form":case"query":this.queryToTsInterface(e,t);break;default:var s=this.deepCloneToType(e);this.formatToTsInterface(s,t)}return`/** ${r}-${this.apiUrl} */
`+this.exportStr}}const t=new class{constructor(){this.toTsCompile=new e(location.href),this.prevValue=""}createElementFun(e){var t=document.createElement(e.elem);return t.innerText=e.innerText||"",t.classList=e.classList||"",t.type=e.type||"",t}contentLoad(e){var e=e.target,t=this.createElementFun({classList:"to-ts"}),n=this.createBtnWrapper(),r=this.createSeparator(),s=this.createQueryBtn(),a=this.createBodyBtn(),o=this.createResBtn(),i=this.createQueryAndResBtn(),c=this.createBodyAndResBtn(),l=this.createallBtn();t.appendChild(n),t.appendChild(r),t.appendChild(s),t.appendChild(a),t.appendChild(o),t.appendChild(i),t.appendChild(c),t.appendChild(l),e.body.appendChild(t)}createBtnWrapper(){return this.createElementFun({elem:"h4",classList:"to-ts-title",innerText:"接口转为ts interface"})}createSeparator(){var e=this.createElementFun({elem:"input",type:"text",classList:"separator"}),t=this.createElementFun({elem:"div",classList:"separator-wrapper",innerText:"每行分隔符"});return t.appendChild(e),e.value=this.toTsCompile.separator,e.onblur=e=>{this.toTsCompile.separator=e.target.value},t}createResBtn(){const e=this.createElementFun({elem:"button",classList:"to-ts-res-btn",innerText:"返回值转换"});return e.onclick=()=>{this.clickCallBack(e,"resBtn")},e}createBodyBtn(){const e=this.createElementFun({elem:"button",classList:"to-ts-req-btn",innerText:"Body参数转换"});return e.onclick=()=>{this.clickCallBack(e,"bodyBtn")},e}createQueryBtn(){const e=this.createElementFun({elem:"button",classList:"to-ts-query-btn",innerText:"Query参数转换"});return e.onclick=()=>{this.clickCallBack(e,"queryBtn")},e}createQueryAndResBtn(){const e=this.createElementFun({elem:"button",classList:"to-ts-req-btn and",innerText:"query和返回值转换"});return e.onclick=()=>{this.clickCallBack(e,"queryAndResBtn","query和返回值转换")},e}createBodyAndResBtn(){const e=this.createElementFun({elem:"button",classList:"to-ts-req-btn and-body",innerText:"body和返回值转换"});return e.onclick=()=>s(this,void 0,void 0,function*(){this.clickCallBack(e,"bodyAndResBtn","body和返回值转换")}),e}createallBtn(){const e=this.createElementFun({elem:"button",classList:"to-ts-req-btn and-all",innerText:"全部转换"});return e.onclick=()=>{this.clickCallBack(e,"allBtn","全部转换")},e}clickCallBack(t,n,r=""){return s(this,void 0,void 0,function*(){t.innerText="转换中...",this.prevValue="";var e=yield a();"queryAndResBtn"===n?(this.callbackFunc(t,"queryBtn",!1,r,e),this.callbackFunc(t,"resBtn",!0,r,e)):"bodyAndResBtn"===n?(this.callbackFunc(t,"bodyBtn",!1,r,e),this.callbackFunc(t,"resBtn",!0,r,e)):"allBtn"===n?(this.callbackFunc(t,"queryBtn",!1,r,e),this.callbackFunc(t,"bodyBtn",!1,r,e),this.callbackFunc(t,"resBtn",!0,r,e)):this.callbackFunc(t,n,!1,r,e)})}callbackFunc(r,s,a=!1,o="",i){try{var c=(i=JSON.parse(i).data).title;let e=i[m[s].field],t=("string"==typeof e&&(e=new Function("return "+i[m[s].field])()),"");var l=i.path.replace(".do","").split("/"),d=l[l.length-1];let n=d;if(-1<d.indexOf("-")){const u=d.split("-");u.forEach((e,t)=>{0<t&&(u[t]=h(e))}),n=u.join("")}"resBtn"===s?(n+="Res",i.res_body_is_json_schema&&"json"===i.res_body_type&&(e=e.properties,t="json_schema")):"bodyBtn"===s?(n+="Body","form"===i.req_body_type?(e=i.req_body_form,t="form"):i.req_body_is_json_schema&&(e=e.properties,t="json_schema")):"queryBtn"===s&&(n+="Query",t="query");var p=this.toTsCompile.compile(e,n,t,c);a?(y(this.prevValue+p),r.innerText=o):(y(p),r.innerText=m[s].innerText),this.prevValue=this.prevValue+p,f({text:"复制成功",type:"success"})}catch(e){console.error(e),this.prevValue="",r.innerText=a?o:m[s].innerText,f({text:"生成失败, 请检查是否有"+m[s].innerText,type:"error"})}}};return document.addEventListener("DOMContentLoaded",function(e){t.contentLoad(e)}),t});
